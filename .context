# Sales Intelligence System — Project Context
# Last updated: 2026-02-18

## Project Vision
Build a smart agentic sales intelligence platform for Onsite Teams (Construction SaaS).
Help sales team with real-time alerts, performance tracking, and actionable insights.

## Architecture
- Frontend: Next.js 16 (App Router) on port 3000
- Backend: FastAPI on port 8000
- Database: Supabase (PostgreSQL) — free tier (500MB)
- Auth: Supabase Auth + JWT (local decode in backend)
- API: Frontend calls backend directly (http://localhost:8000/api) bypassing Next.js proxy

## Data Flow
1. CSV upload (Zoho CRM export) → client-side parse for instant display
2. Backend computes summary + agent profiles → saves to Supabase
3. On refresh → loads pre-computed summary from Supabase (fast, ~1-2MB)
4. Future: Zoho webhooks for real-time lead updates (not implemented yet)

## Key Decisions
- DO NOT store 300K raw leads in Supabase (free tier limit)
- Store only pre-computed summaries (~1-2MB) and agent profiles
- Revenue only counted from actual sales (sale_done=1), not all leads
- Parse "Rs. 42,000.00" currency format from Zoho exports
- Leads page is placeholder until Zoho webhook integration
- Deal Owner is the primary field (not Lead Owner) for all analytics

## Database Tables
- dashboard_summary: single row with JSONB columns (kpis, charts, insights, sales_data, etc.)
- agent_profiles: per-deal-owner performance profiles with notes
- users: app users (linked to Supabase Auth)
- alerts, leads, briefs: future use (Zoho integration)

## Known Issues / Tech Debt
- [ ] Supabase user lookup: auth_id returns 400, id returns 406 (only email works)
- [ ] Hydration mismatch warning (browser extension related, harmless)
- [ ] sw.js 404 spam in console (no service worker registered)
- [ ] Leads page empty until Zoho integration
- [ ] Dashboard home shows 0s until Zoho integration

## Completed Features
- [x] Auth: Supabase login/session persistence, JWT decode
- [x] Intelligence Dashboard: 8 tabs (Sales, Overview, Pipeline, Team, Sources, Aging, Trends, Deep Dive)
- [x] Sales Tab: Revenue KPIs, monthly trend, region/source/owner analysis, dual leaderboards (by count + revenue)
- [x] Agent Profiles: auto-computed per deal owner with performance, patterns, strengths, concerns, monthly trends, notes
- [x] Revenue parsing: handles "Rs. 42,000.00" format
- [x] Data persistence: summary + agent profiles saved to Supabase
- [x] Direct API calls (bypass Next.js proxy to fix auth header stripping)
- [x] FastAPI redirect_slashes=False (fix 307 auth loop)

## Completed — Smart Alert Agent
- [x] Smart Alert Agent: auto-generates alerts on CSV upload
- [x] 10 alert rules: stale leads, demo dropout, low conversion, hot prospects,
      priority overload, inactive agents, top performer, revenue milestone,
      pipeline risk, follow-up needed
- [x] Severity levels: critical, high, medium, info
- [x] Beautiful alert cards with icons, severity colors, agent names
- [x] Mark as read, filter by severity
- [x] Alerts saved to Supabase, persist across sessions

## Upcoming / Roadmap
- [ ] Agentic notifications: WhatsApp/email alerts for sales team
- [ ] Zoho webhook integration: real-time lead updates
- [ ] Agent chat: sales reps can ask questions about their pipeline
- [ ] Preferences system: per-user dashboard customization
- [ ] Smart data management: deduplication on zoho_lead_id + lead_phone
- [ ] Connect with n8n for workflow automation

## CSV Columns (Zoho Export)
Key fields used: lead_name, deal_owner, lead_status, sale_done, sale_done_date,
annual_revenue (Rs. format), price_pitched (Rs. format), demo_done, demo_booked,
lead_source, state_mobile, region, user_date, last_touched_date_new, company_name,
sales_stage, is_prospect, lead_owner_manager, pre_qualification, Team_size,
user_profession, call_disposition, campaign_name, lead_notes, notes_date

## Supabase Credentials
- Project: jfuvhaampbngijfxgnnf
- URL: https://jfuvhaampbngijfxgnnf.supabase.co
- User: dhruv.tomar@onsiteteams.com

## GitHub
- Repo: aiagentwithdhruv/Onsite
- Branch: main

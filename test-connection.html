<!DOCTYPE html>
<html>
<head>
  <title>Test Quotation Generator Connection</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 800px; margin: 0 auto; }
    button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
    .result { margin: 20px 0; padding: 15px; border-radius: 8px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>üîß Test Quotation Generator Connection</h1>
  
  <h2>Step 1: Test Web App URL</h2>
  <button onclick="testURL()">Test Web App URL</button>
  <div id="urlResult"></div>
  
  <h2>Step 2: Test with Sample Data</h2>
  <button onclick="testSend()">Send Test Quotation</button>
  <div id="sendResult"></div>
  
  <h2>Step 3: Check Logs</h2>
  <p>After clicking above, go to Google Apps Script ‚Üí View ‚Üí Executions to see logs.</p>
  
  <script>
    const SCRIPT_URL = 'https://script.google.com/a/macros/onsiteteams.com/s/AKfycbxVxmpYwqy92r6c_vd_HkR1op9f-MxngH9m9CqPT0LdUCJ_0lUejL2wWoY3qNHYeSuj/exec';
    
    function testURL() {
      const resultDiv = document.getElementById('urlResult');
      resultDiv.innerHTML = '<p>Testing...</p>';
      
      fetch(SCRIPT_URL, { method: 'GET' })
        .then(response => response.text())
        .then(text => {
          resultDiv.innerHTML = `
            <div class="result success">
              <strong>‚úÖ Connection Successful!</strong>
              <p>Response: ${text}</p>
            </div>
          `;
        })
        .catch(err => {
          resultDiv.innerHTML = `
            <div class="result error">
              <strong>‚ùå Connection Failed</strong>
              <p>Error: ${err.message}</p>
              <p>Check if Web App URL is correct and deployment is active.</p>
            </div>
          `;
        });
    }
    
    function testSend() {
      const resultDiv = document.getElementById('sendResult');
      resultDiv.innerHTML = '<p>Sending test data...</p>';
      
      const testData = {
        refNumber: 'ONS-2026-TEST',
        salesperson: 'Test|test@onsiteteams.com',
        salespersonName: 'Test',
        salespersonEmail: 'test@onsiteteams.com', // CHANGE THIS TO YOUR EMAIL
        region: 'national',
        validDays: '7',
        clientName: 'Test Client',
        companyName: 'Test Company',
        clientEmail: 'test@example.com', // CHANGE THIS TO YOUR EMAIL
        clientPhone: '+91 9876543210',
        clientLocation: 'Test City',
        plan: 'business_plus',
        numUsers: '3',
        duration: '1',
        customAmount: '',
        addons: [],
        discount: '0',
        paymentTerms: '100_upfront',
        specialNotes: 'This is a test',
        action: 'send'
      };
      
      console.log('Sending:', testData);
      
      fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(testData),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(response => {
        console.log('Response status:', response.status);
        return response.text();
      })
      .then(text => {
        console.log('Response text:', text);
        let result;
        try {
          result = JSON.parse(text);
        } catch (e) {
          result = { message: text };
        }
        
        if (result.success !== false) {
          resultDiv.innerHTML = `
            <div class="result success">
              <strong>‚úÖ Test Data Sent Successfully!</strong>
              <pre>${JSON.stringify(result, null, 2)}</pre>
              <p><strong>Next Steps:</strong></p>
              <ol>
                <li>Go to Google Apps Script ‚Üí View ‚Üí Executions</li>
                <li>Check the latest execution logs</li>
                <li>Look for "Email sent to..." messages</li>
                <li>Check your email inbox</li>
              </ol>
            </div>
          `;
        } else {
          resultDiv.innerHTML = `
            <div class="result error">
              <strong>‚ùå Error</strong>
              <pre>${JSON.stringify(result, null, 2)}</pre>
            </div>
          `;
        }
      })
      .catch(err => {
        console.error('Error:', err);
        resultDiv.innerHTML = `
          <div class="result error">
            <strong>‚ùå Request Failed</strong>
            <p>Error: ${err.message}</p>
            <p>Check browser console (F12) for more details.</p>
          </div>
        `;
      });
    }
  </script>
</body>
</html>
